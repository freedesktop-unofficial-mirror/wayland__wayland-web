<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html> 

<head> 
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"> 
<link href="wayland.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="generated-toc.js"></script>
<title>XWayland</title> 
</head>

<body>
<h1><a href="/"><img src="wayland.png" alt="Wayland logo"></a></h1>

<div id="generated-toc" class="generate_from_h2"></div>

<h2>X Clients under Wayland (XWayland)</h2>

<p>
  Wayland is a complete window system in itself, but even so, if we're
  migrating away from X, it makes sense to have a good backwards
  compatibility story.  With a few changes, the Xorg server can be
  modified to use wayland input devices for input and forward either
  the root window or individual top-level windows as wayland surfaces.
  The server still runs the same 2D driver with the same acceleration
  code as it does when it runs natively.  The main difference is that
  wayland handles presentation of the windows instead of KMS.
</p>

<p><img src="x-on-wayland.png" alt="X on Wayland architecture diagram"></p>

<h2>Building XWayland</h2>

<p>
  Follow the <a href="http://wayland.freedesktop.org/building.html">main
  Wayland build instructions first</a>.
</p>

<h2>libxtrans</h2>
<p>
  It may be necessary to build libxtrans from
  git://anongit.freedesktop.org/xorg/lib/libxtrans before building
  xserver on 32-bit systems.
</p>

<h2>X.org</h2>

<pre>    git clone git://anongit.freedesktop.org/xorg/xserver -b xwayland-1.12
    cd xserver
    ./autogen.sh --prefix=$WLD
    make
    make install
    cd ..
</pre>

<h2>DDX</h2>

<p>
  The Device Dependent part of X.  Only one of these is necessary.
  xf86-video-intel works with Intel open source video drivers.
  xf86-video-ati works with AMD Radeon open source drivers.
  xf86-video-wlshm is implemented in software, so it works on all
  hardware, but is somewhat less complete.  xf86-video-nouveau works
  with Nvidia / Nouveau.
</p>
    
<pre>    git clone git://anongit.freedesktop.org/xorg/driver/xf86-video-intel -b xwayland
    cd xf86-video-intel
    ./autogen.sh --prefix=$WLD
    make
    make install
    cd ..
</pre>

<pre>    git clone https://github.com/RAOF/xf86-video-ati -b xwayland
    cd xf86-video-ati
    ./autogen.sh --prefix=$WLD
    make
    make install
    cd ..
</pre>

<pre>    git clone git://people.freedesktop.org/~iksaif/xf86-video-wlshm
    cd xf86-video-wlshm
    ./autogen.sh --prefix=$WLD
    make
    make install
    cd ..
</pre>

<pre>    git clone https://github.com/RAOF/xf86-video-nouveau -b xwayland
    cd xf86-video-nouveau
    ./autogen.sh --prefix=$WLD
    make
    make install
    cd ..
</pre>

<h2>Paths</h2>

<p>
  Without this you will get the error "XKB: Failed to compile keymap".
</p>

<pre>    mkdir -p $WLD/share/X11/xkb/rules
    ln -s /usr/share/X11/xkb/rules/evdev $WLD/share/X11/xkb/rules/
    ln -s /usr/bin/xkbcomp $WLD/bin/
</pre>


<h2>Running</h2>

<p>
  The Intel and ATI / AMD / Radeon DDXes should work automatically.
  wlshm requires an xorg.conf containing 'Driver "wlshm"'.
</p>

<p>
  Run weston or weston-launch, which need to be SUID root to be able
  to spawn X.org.  weston-launch only works outside of X, and requires
  that you enable systemd session support for weston-launch (how?) or
  add yourself to the "weston-launch" group:
</p>

<pre>    sudo chown root weston
    sudo chmod +s weston
    weston --xserver
    sudo chmod ugo+rw /tmp/wayland* # weston-launch fixes this
</pre>

<pre>    sudo groupadd weston-launch
    sudo usermod -a -G weston-launch $USER
    # Log all the way out (of X, etc.)
    sudo chown root weston-launch
    sudo chmod +s weston-launch
    weston-launch -- --xserver
</pre>

<p>
  The weston console output will include "xserver listening on display
  :1".  Within weston-terminal you will find $DISPLAY has already
  been set.  Run an X client.  
</p>

<p>
  Weston listens on the X socket until a client attempts to connect,
  then launches X.org.
</p>

</body>
</html> 
